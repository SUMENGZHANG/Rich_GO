# internal åŒ…è¯¦è§£

## ä»€ä¹ˆæ˜¯ internal åŒ…ï¼Ÿ

`internal` æ˜¯ Go è¯­è¨€çš„ç‰¹æ®Šç›®å½•åï¼Œå…·æœ‰**åŒ…å¯è§æ€§é™åˆ¶**çš„ç‰¹æ€§ã€‚

## æ ¸å¿ƒç‰¹æ€§

### 1. è®¿é—®è§„åˆ™

`internal` ç›®å½•ä¸‹çš„åŒ…**åªèƒ½è¢«ä»¥ä¸‹ä½ç½®å¯¼å…¥**ï¼š
- âœ… çˆ¶ç›®å½•ï¼ˆ`rich_go/`ï¼‰
- âœ… çˆ¶ç›®å½•çš„å­ç›®å½•ï¼ˆ`cmd/`, `pkg/` ç­‰ï¼‰
- âŒ **å¤–éƒ¨é¡¹ç›®æ— æ³•å¯¼å…¥**

### 2. ç¤ºä¾‹è¯´æ˜

```
rich_go/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go          âœ… å¯ä»¥å¯¼å…¥ internal/*
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ app/             âœ… å¯ä»¥å¯¼å…¥ internal/*
â”‚   â””â”€â”€ server/          âœ… å¯ä»¥å¯¼å…¥ internal/*
â”‚
â”œâ”€â”€ pkg/
â”‚   â””â”€â”€ utils.go         âœ… å¯ä»¥å¯¼å…¥ internal/*
â”‚
â””â”€â”€ å¤–éƒ¨é¡¹ç›®/             âŒ æ— æ³•å¯¼å…¥ internal/*
    â””â”€â”€ other.go
```

### 3. ä»£ç ç¤ºä¾‹

#### âœ… å¯ä»¥å¯¼å…¥ï¼ˆé¡¹ç›®å†…éƒ¨ï¼‰

```go
// cmd/main.go - âœ… å¯ä»¥
package main

import "rich_go/internal/app"  // âœ… å¯ä»¥å¯¼å…¥

func main() {
    app.New()
}
```

```go
// internal/app/app.go - âœ… å¯ä»¥
package app

import "rich_go/internal/server"  // âœ… å¯ä»¥å¯¼å…¥

func New() *App {
    server.NewHTTPServer("8080")
    // ...
}
```

#### âŒ æ— æ³•å¯¼å…¥ï¼ˆå¤–éƒ¨é¡¹ç›®ï¼‰

```go
// å…¶ä»–é¡¹ç›®çš„ä»£ç  - âŒ æ— æ³•å¯¼å…¥
package main

import "rich_go/internal/app"  // âŒ ç¼–è¯‘é”™è¯¯ï¼

func main() {
    app.New()  // æ— æ³•è®¿é—®
}
```

**é”™è¯¯ä¿¡æ¯**:
```
use of internal package rich_go/internal/app not allowed
```

## ä¸ºä»€ä¹ˆä½¿ç”¨ internalï¼Ÿ

### 1. å°è£…å†…éƒ¨å®ç°

```go
// internal/server/http_server.go
package server

// HTTPServer æ˜¯å†…éƒ¨å®ç°ï¼Œå¤–éƒ¨ä¸åº”è¯¥ç›´æ¥ä½¿ç”¨
type HTTPServer struct {
    router *gin.Engine
    port   string
}

// å¦‚æœæ”¾åœ¨ pkg/ ä¸‹ï¼Œå¤–éƒ¨é¡¹ç›®å¯ä»¥å¯¼å…¥å¹¶ç›´æ¥ä½¿ç”¨
// æ”¾åœ¨ internal/ ä¸‹ï¼Œå¤–éƒ¨æ— æ³•å¯¼å…¥ï¼Œåªèƒ½é€šè¿‡ app åŒ…ä½¿ç”¨
```

### 2. é˜²æ­¢å¤–éƒ¨ä¾èµ–

**é—®é¢˜åœºæ™¯**:
- å¦‚æœ `internal/server` æ”¾åœ¨ `pkg/server` ä¸‹
- å¤–éƒ¨é¡¹ç›®å¯èƒ½ç›´æ¥å¯¼å…¥ `pkg/server`
- å½“ä½ ä¿®æ”¹ `pkg/server` çš„å†…éƒ¨å®ç°æ—¶
- å¯èƒ½ç ´åå¤–éƒ¨é¡¹ç›®çš„ä»£ç 

**è§£å†³æ–¹æ¡ˆ**:
- å°†å†…éƒ¨å®ç°æ”¾åœ¨ `internal/server` ä¸‹
- å¤–éƒ¨é¡¹ç›®æ— æ³•å¯¼å…¥
- å¯ä»¥è‡ªç”±ä¿®æ”¹å†…éƒ¨å®ç°
- åªé€šè¿‡ `pkg/` æš´éœ²ç¨³å®šçš„å…¬å…± API

### 3. æ¸…æ™°çš„ä»£ç ç»„ç»‡

```
rich_go/
â”œâ”€â”€ internal/          # å†…éƒ¨å®ç°ï¼ˆç§æœ‰ï¼‰
â”‚   â”œâ”€â”€ app/          # åº”ç”¨é€»è¾‘
â”‚   â””â”€â”€ server/       # HTTP æœåŠ¡å™¨å®ç°
â”‚
â””â”€â”€ pkg/               # å…¬å…± APIï¼ˆå…¬å¼€ï¼‰
    â””â”€â”€ client/       # å®¢æˆ·ç«¯åº“ï¼ˆå¤–éƒ¨å¯ä»¥ä½¿ç”¨ï¼‰
```

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1: Web åº”ç”¨

```
rich_go/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/main.go     # å…¥å£
â”‚
â”œâ”€â”€ internal/              # å†…éƒ¨å®ç°
â”‚   â”œâ”€â”€ handler/          # HTTP å¤„ç†å‡½æ•°
â”‚   â”œâ”€â”€ service/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ repository/       # æ•°æ®è®¿é—®
â”‚   â””â”€â”€ model/            # æ•°æ®æ¨¡å‹
â”‚
â””â”€â”€ pkg/                   # å…¬å…±åº“
    â””â”€â”€ client/           # å®¢æˆ·ç«¯ SDKï¼ˆå¤–éƒ¨å¯ä»¥ä½¿ç”¨ï¼‰
```

### åœºæ™¯ 2: åº“é¡¹ç›®

```
rich_go/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ example/main.go   # ç¤ºä¾‹ç¨‹åº
â”‚
â”œâ”€â”€ internal/              # å†…éƒ¨å®ç°
â”‚   â”œâ”€â”€ parser/           # è§£æå™¨å®ç°
â”‚   â””â”€â”€ validator/        # éªŒè¯å™¨å®ç°
â”‚
â””â”€â”€ pkg/                   # å…¬å…± API
    â””â”€â”€ api.go            # å…¬å…±æ¥å£ï¼ˆå¤–éƒ¨ä½¿ç”¨ï¼‰
```

## internal vs pkg

| ç‰¹æ€§ | internal/ | pkg/ |
|------|-----------|------|
| **å¯è§æ€§** | ä»…é¡¹ç›®å†…éƒ¨ | å¤–éƒ¨å¯è®¿é—® |
| **ç”¨é€”** | å†…éƒ¨å®ç° | å…¬å…± API |
| **ç¨³å®šæ€§** | å¯ä»¥é¢‘ç¹å˜æ›´ | éœ€è¦ä¿æŒç¨³å®š |
| **å¤–éƒ¨ä¾èµ–** | ä¸å…è®¸ | å…è®¸ |

### é€‰æ‹©å»ºè®®

**ä½¿ç”¨ internal/**:
- âœ… å†…éƒ¨å®ç°ç»†èŠ‚
- âœ… ä¸å¸Œæœ›å¤–éƒ¨ä¾èµ–çš„ä»£ç 
- âœ… å¯èƒ½é¢‘ç¹å˜æ›´çš„ä»£ç 

**ä½¿ç”¨ pkg/**:
- âœ… å…¬å…± API
- âœ… å¸Œæœ›å¤–éƒ¨é¡¹ç›®ä½¿ç”¨çš„åº“
- âœ… éœ€è¦ä¿æŒ API ç¨³å®šçš„ä»£ç 

## å½“å‰é¡¹ç›®ä¸­çš„ internal

### å½“å‰ç»“æ„

```
rich_go/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go          # å¯¼å…¥ internal/app
â”‚
â””â”€â”€ internal/
    â”œâ”€â”€ app/            # åº”ç”¨æ ¸å¿ƒï¼ˆå†…éƒ¨å®ç°ï¼‰
    â”‚   â””â”€â”€ app.go
    â”‚
    â””â”€â”€ server/         # HTTP æœåŠ¡å™¨ï¼ˆå†…éƒ¨å®ç°ï¼‰
        â””â”€â”€ http_server.go
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **app åŒ…**: 
   - åº”ç”¨çš„æ ¸å¿ƒé€»è¾‘
   - åè°ƒå„ä¸ªç»„ä»¶
   - å†…éƒ¨å®ç°ï¼Œä¸éœ€è¦å¤–éƒ¨è®¿é—®

2. **server åŒ…**:
   - HTTP æœåŠ¡å™¨çš„å…·ä½“å®ç°
   - è·¯ç”±æ³¨å†Œå’Œä¸­é—´ä»¶é…ç½®
   - å†…éƒ¨å®ç°ï¼Œé€šè¿‡ app åŒ…ä½¿ç”¨

### è°ƒç”¨å…³ç³»

```
main() 
  â†“ import
internal/app
  â†“ import
internal/server
  â†“ import
gin (å¤–éƒ¨åº“)
```

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **å†…éƒ¨å®ç°æ”¾åœ¨ internal/**
   ```go
   // internal/server/http_server.go
   package server
   
   type HTTPServer struct {
       // å†…éƒ¨å®ç°
   }
   ```

2. **å…¬å…± API æ”¾åœ¨ pkg/**
   ```go
   // pkg/client/client.go
   package client
   
   // å…¬å…± APIï¼Œå¤–éƒ¨å¯ä»¥ä½¿ç”¨
   func NewClient() *Client {
       // ...
   }
   ```

3. **é€šè¿‡æ¥å£æš´éœ²åŠŸèƒ½**
   ```go
   // pkg/api/api.go - å…¬å…±æ¥å£
   package api
   
   type Server interface {
       Start() error
   }
   
   // internal/server/http_server.go - å®ç°
   package server
   
   type HTTPServer struct {}
   
   func (s *HTTPServer) Start() error {
       // å®ç°
   }
   ```

### âŒ é¿å…åšæ³•

1. âŒ å°†å†…éƒ¨å®ç°æ”¾åœ¨ `pkg/` ä¸‹
2. âŒ å¤–éƒ¨é¡¹ç›®ç›´æ¥ä¾èµ– `internal/` ä¸‹çš„åŒ…
3. âŒ åœ¨ `internal/` ä¸‹æ”¾ç½®å…¬å…± API

## æ€»ç»“

**internal åŒ…çš„æ ¸å¿ƒä»·å€¼**:
- ğŸ”’ **å°è£…**: éšè—å†…éƒ¨å®ç°
- ğŸ›¡ï¸ **ä¿æŠ¤**: é˜²æ­¢å¤–éƒ¨ä¾èµ–
- ğŸ“¦ **ç»„ç»‡**: æ¸…æ™°çš„ä»£ç ç»“æ„
- ğŸ”„ **çµæ´»**: å¯ä»¥è‡ªç”±ä¿®æ”¹å†…éƒ¨å®ç°

**åœ¨ä½ çš„é¡¹ç›®ä¸­**:
- `internal/app/` - åº”ç”¨æ ¸å¿ƒé€»è¾‘ï¼ˆç§æœ‰ï¼‰
- `internal/server/` - HTTP æœåŠ¡å™¨å®ç°ï¼ˆç§æœ‰ï¼‰
- å¤–éƒ¨é¡¹ç›®æ— æ³•ç›´æ¥è®¿é—®è¿™äº›åŒ…
- åªèƒ½é€šè¿‡ `cmd/main.go` ä½¿ç”¨åº”ç”¨åŠŸèƒ½

è¿™å°±æ˜¯ Go è¯­è¨€çš„åŒ…å¯è§æ€§æœºåˆ¶ï¼Œå¸®åŠ©ä½ æ„å»ºæ›´å¥½çš„é¡¹ç›®æ¶æ„ï¼

